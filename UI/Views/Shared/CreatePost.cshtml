@using UI.Models
@using UI.Controllers
@model UI.Models.SocialViewModel

<link rel="stylesheet" href="../css/bootstrap-tagsinput.css">
<script src="../js/bootstrap-tagsinput.js"></script>

<!-- Trigger the modal with a button -->
<div class="container">
    <div class="panel panel-primary" data-toggle="modal" data-target="#myModal"
         style="width:750px">
        <div class="panel-heading">Create Post</div>

        <div class="panel-body">
            <div class="text-muted">
                What's on yout mind...? <br />
            </div>
            <hr />
            <button type="button" class="btn btn-primary">Share</button>
            <button type="button" class="btn btn-success">Add Photo</button>
            <button type="button" class="btn btn-info">Tag Friends</button>
        </div>

    </div>
</div>

<!-- Modal -->

<div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Create Post</h4>
            </div>
            <form action="~/Social/CreatePost" method="post" enctype="multipart/form-data" role="form">
                <div class="modal-body">
                    <textarea name=Post.Content rows="5" placeholder="Share everyone - What's on yout mind?" class="form-control" style="min-width: 90%; min-height: 80%"></textarea>
                </div>
                <div class="modal-footer">
                    <div class="input-group-btn width100">
                        <input type="file" class="custom-file-input" name=Post.Picture1 id=Post.Picture1>
                        <button type="submit" class="btn btn-primary">Share</button>
                        <button type="button" class="btn btn-info">Tag Friends</button>
                        @*<input type="text" value="" data-role="tagsinput" id="tags" class="form-control">*@
                        <button type="button" class="btn btn-danger" data-dismiss="modal" style="float:right;">Close</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    //$('input').tagsinput({
    //    typeahead: {
    //        source: function (query) {
    //            return $.get('http://someservice.com');
    //        }
    //    }
    //});

    //$('input').tagsinput({
    //    typeahead: {
    //        source: function (query) {
    //            return $.getJSON('citynames.json');
    //        }
    //    }
    //});
</script>


@*<script>


    function insertNodeAtCursor(node) {
        var sel, range, html;
        if (window.getSelection) {
            sel = window.getSelection();
            if (sel.getRangeAt && sel.rangeCount) {
                range = sel.getRangeAt(0);
                range.insertNode(node);
                sel.removeAllRanges();
            }
        }
    }

    function SelectUserList_change() {

        var SelectUserList = document.getElementById("SelectUserList")
        var selectedValue = SelectUserList.value;
        if (selectedValue != "") {
            var selectedText = SelectUserList.options[SelectUserList.selectedIndex].text;
            var viewTextNode = document.createElement("image");
            viewTextNode.setAttribute("class", "mention");
            viewTextNode.setAttribute("src", selectedText);
            viewTextNode.setAttribute("alt", selectedText);
            viewTextNode.setAttribute("user-id", selectedValue);

            var mainDiv = document.getElementById("PostContentDiv");
            mainDiv.focus();
            insertNodeAtCursor(viewTextNode);

            document.getElementById("select-user").style.display = "none";
        }
    }

    function postcontent_onkeypress(e) {
        if (e.key == '@@') {
            document.getElementById("select-user").style.display = "block";
        }
    }

    function onSubmit() {
        var elements = document.getElementsByClassName("mention");
        var jsonMentions = document.getElementById("JsonMentions");
        var mainDiv = document.getElementById("PostContentDiv");

        var arrMentions = [];
        for (var i = 0; i < elements.length; i++) {
            arrMentions.push(elements[i].getAttribute("user-id"));
        }
        console.log(jsonMentions);
        jsonMentions.value = JSON.stringify(arrMentions);

        while (mainDiv.getElementsByClassName("mention").length > 0) {
            var children = mainDiv.getElementsByClassName("mention");

            console.log(mainDiv.innerHTML);
            for (var i = 0; i < children.length; i++) {
                var oldChild = children[i];
                var newChild = document.createElement("span");

                newChild.innerText = oldChild.getAttribute("src");
                children[i].parentNode.replaceChild(newChild, oldChild)
            }
        }
        document.getElementById("PostContent").value = mainDiv.innerText;
        console.log(mainDiv.innerHTML);

    }




</script>*@


@*<div id="PostContentDiv" onkeypress="postcontent_onkeypress(event)" class="textarea col-md-10" contenteditable="true">
    @@*Html(m => m.PostContent, new { required = true, rows = 10, @@class = "form-control", onkeypress = "postcontent_onkeypress(event)" })*@
@*</div>
@@Html.HiddenFor(m => m.PostContent, new { id = "PostContent" })



TODO change @@item.Id, @@item.Name to your fields
<div class="form-group" id="select-user">
    <label for="SelectUser" class="col-md-2 control-label">Select a user</label>
    <select id="SelectUserList" onchange="javascript: SelectUserList_change();" class="form-control">
        <option></option>
        @@foreach (var item in ViewBag.Mentions)
            {
            <option value= @@item.Id>@@item.Name</option>
        }
    </select>
</div>

<div class="form-group">
    <div class="col-md-offset-2 col-md-10">
        <input type="submit" onclick="javascript: onSubmit();" class="btn btn-default" value="Upload" />
    </div>
</div>*@

